<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Converge + Cignal TV</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/ 4.7.1/shaka-player.ui.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.1/controls.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Segoe UI',sans-serif;background:#000;color:#fff;min-height:100vh;overflow-x:hidden;}
        .top-bar{background:rgba(20,20,30,0.95);padding:10px 15px;display:flex;justify-content:space-between;align-items:center;font-size:14px;position:fixed;top:0;left:0;right:0;z-index:1000;}
        .time{font-weight:600;}
        .status-icons{display:flex;gap:15px;align-items:center;}
        .player-area{position:relative;height:280px;background:#000;margin-top:50px;}
        #video-container{width:100%;height:100%;background:#000;}
        #video{width:100%;height:100%;object-fit:contain;}
        .channel-info{background:rgba(0,0,0,0.7);padding:8px 15px;position:absolute;top:0;left:0;right:0;display:flex;justify-content:space-between;align-items:center;font-size:15px;}
        .live-indicator{background:#e74c3c;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:bold;}
        .controls{display:flex;justify-content:center;gap:12px;padding:15px;flex-wrap:wrap;}
        .btn{background:#00bfa5;color:white;border:none;padding:12px 20px;border-radius:8px;font-weight:bold;display:flex;align-items:center;gap:8px;min-width:100px;justify-content:center;cursor:pointer;}
        .btn.stop{background:#e67e22;}
        .btn.fullscreen{background:#7f8c8d;}
        .bottom-tabs{display:flex;background:#111;padding:10px;gap:5px;overflow-x:auto;white-space:nowrap;}
        .tab{padding:10px 20px;background:#2c3e50;border-radius:25px;min-width:fit-content;cursor:pointer;}
        .tab.active{background:#00bfa5;}
        .tab.favorites i{color:#e74c3c;}
        .search-bar{margin:15px;position:relative;}
        .search-bar input{width:100%;padding:14px 20px;background:#222;border:none;border-radius:30px;color:white;font-size:16px;}
        .recently{padding:0 15px 10px;color:#00bfa5;font-weight:bold;}
        .recent-list{display:flex;gap:15px;overflow-x:auto;padding:0 15px 20px;}
        .recent-item{min-width:120px;text-align:center;position:relative;cursor:pointer;}
        .recent-logo{width:80px;height:80px;border-radius:12px;object-fit:contain;background:#222;margin-bottom:8px;}
        .recent-name{font-size:13px;opacity:0.9;}
        .channels-section{padding:15px 15px 100px;}
        .channels-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:15px;}
        .channel-card{background:rgba(255,255,255,0.05);border-radius:12px;overflow:hidden;cursor:pointer;position:relative;transition:0.3s;border:2px solid transparent;}
        .channel-card:hover{transform:translateY(-5px);border-color:#00bfa5;}
        .channel-card.playing{border-color:#00bfa5;box-shadow:0 0 15px rgba(0,191,165,0.6);}
        .channel-logo{width:100%;height:90px;object-fit:contain;background:#111;padding:10px;}
        .channel-name{text-align:center;padding:8px;font-size:13px;font-weight:600;}
        .fav-heart{position:absolute;top:8px;right:8px;background:rgba(0,0,0,0.6);width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;}
        .fav-heart.active{color:#e74c3c;}
        .source-tag{position:absolute;bottom:8px;left:8px;background:rgba(0,0,0,0.7);padding:2px 8px;border-radius:4px;font-size:10px;}
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="time" id="clock">00:00</div>
        <div class="status-icons">
            <i class="fas fa-wifi"></i>
            <i class="fas fa-signal"></i>
            <i class="fas fa-battery-full"></i>
        </div>
    </div>

    <div class="player-area">
        <div class="channel-info">
            <div id="ch-name">Loading...</div>
            <div class="live-indicator">LIVE</div>
        </div>
        <div id="video-container">
            <video id="video" controls autoplay playsinline crossorigin="anonymous"></video>
        </div>
    </div>

    <div class="controls">
        <button class="btn stop" onclick="stopPlayback()">Stop</button>
        <button class="btn" onclick="prevChannel()">CH-</button>
        <button class="btn" onclick="nextChannel()">CH+</button>
        <button class="btn" onclick="reloadChannel()">Reload</button>
        <button class="btn fullscreen" onclick="toggleFullscreen()">Fullscreen</button>
    </div>

    <div class="bottom-tabs">
        <div class="tab favorites" onclick="showView('favorites')"><i class="fas fa-heart"></i> Favorites</div>
        <div class="tab" onclick="showView('hls')">HLS Only</div>
        <div class="tab active" onclick="showView('converge')">Converge</div>
        <div class="tab" onclick="showView('cignal')">Cignal</div>
    </div>

    <div class="search-bar">
        <input type="text" id="search" placeholder="Search channel..." oninput="renderChannels()">
    </div>

    <div class="recently">RECENTLY WATCHED</div>
    <div class="recent-list" id="recent-list"></div>

    <div class="channels-section">
        <div class="channels-grid" id="channels-grid"></div>
    </div>

    <script>
        // 83 CONVERGE CHANNELS (Kumpleto na talaga!)
        const convergeChannels = [
            {name:"GTV",url:"https://converse.nathcreqtives.com/1143/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723126332757.png",drm:true,source:"converge"},
            {name:"TV5",url:"https://converse.nathcreqtives.com/1088/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723134335547.png",drm:true,source:"converge"},
            {name:"GMA 7",url:"https://converse.nathcreqtives.com/1093/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723126306082.png",drm:true,source:"converge"},
            {name:"RPTV",url:"https://converse.nathcreqtives.com/1094/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723133873954.png",drm:true,source:"converge"},
            {name:"PTV",url:"https://converse.nathcreqtives.com/1086/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723133792284.png",drm:true,source:"converge"},
            {name:"PBO",url:"https://converse.nathcreqtives.com/1078/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723612823404.png",drm:true,source:"converge"},
            {name:"IBC 13",url:"https://converse.nathcreqtives.com/1089/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723128890006.png",drm:true,source:"converge"},
            {name:"UNTV",url:"https://converse.nathcreqtives.com/1091/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723134409636.png",drm:true,source:"converge"},
            {name:"KNOWLEDGE CHANNEL",url:"https://converse.nathcreqtives.com/1340/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723604992973.png",drm:true,source:"converge"},
            {name:"JEEPNEY TV",url:"https://converse.nathcreqtives.com/1250/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723128953472.png",drm:true,source:"converge"},
            {name:"DZMM TELERADYO",url:"https://converse.nathcreqtives.com/1249/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1749519196399.png",drm:true,source:"converge"},
            {name:"ONE SPORTS",url:"https://converse.nathcreqtives.com/1083/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723131202156.png",drm:true,source:"converge"},
            {name:"CINEMA ONE",url:"https://converse.nathcreqtives.com/1283/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723125628005.png",drm:true,source:"converge"},
            {name:"EWTN",url:"https://converse.nathcreqtives.com/1104/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723126078814.png",drm:true,source:"converge"},
            {name:"INC TV",url:"https://converse.nathcreqtives.com/1092/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723605495653.png",drm:true,source:"converge"},
            {name:"CHANNEL NEWS ASIA",url:"https://converse.nathcreqtives.com/1106/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723125590334.png",drm:true,source:"converge"},
            {name:"CINEMAX",url:"https://converse.nathcreqtives.com/1108/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723125660668.png",drm:true,source:"converge"},
            {name:"KAPAMILYA HD",url:"https://converse.nathcreqtives.com/1286/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723129013828.png",drm:true,source:"converge"},
            {name:"NET 25",url:"https://converse.nathcreqtives.com/1090/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723129823252.png",drm:true,source:"converge"},
            {name:"MYX",url:"https://converse.nathcreqtives.com/1252/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723129763447.png",drm:true,source:"converge"},
            {name:"ALIW TV",url:"https://converse.nathcreqtives.com/1109/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723125129835.png",drm:true,source:"converge"},
            {name:"HBO",url:"https://converse.nathcreqtives.com/1065/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723126386617.png",drm:true,source:"converge"},
            {name:"CNN",url:"https://converse.nathcreqtives.com/1073/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723125798255.png",drm:true,source:"converge"},
            {name:"A2Z",url:"https://converse.nathcreqtives.com/1087/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723125016586.png",drm:true,source:"converge"},
            {name:"CELESTIAL MOVIES PINOY",url:"https://converse.nathcreqtives.com/1077/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723219252241.png",drm:true,source:"converge"},
            {name:"RJTV 29",url:"https://converse.nathcreqtives.com/1159/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723133830822.png",drm:true,source:"converge"},
            {name:"CCTV4",url:"https://converse.nathcreqtives.com/1223/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723125521068.png",drm:true,source:"converge"},
            {name:"CARTOON NETWORK",url:"https://converse.nathcreqtives.com/1178/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723125431025.png",drm:true,source:"converge"},
            {name:"VIVA CINEMA",url:"https://converse.nathcreqtives.com/1079/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723134481136.png",drm:true,source:"converge"},
            {name:"HALLYPOP",url:"https://converse.nathcreqtives.com/1152/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1733707474289.png",drm:true,source:"converge"},
            {name:"ALL TV",url:"https://converse.nathcreqtives.com/1179/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723136602348.png",drm:true,source:"converge"},
            {name:"TAP TV",url:"https://converse.nathcreqtives.com/1149/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723134180637.png",drm:true,source:"converge"},
            {name:"DZRH",url:"https://converse.nathcreqtives.com/1174/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723126004028.png",drm:true,source:"converge"},
            {name:"METRO",url:"https://converse.nathcreqtives.com/1267/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723129722508.png",drm:true,source:"converge"},
            {name:"STAR CHANNEL 1",url:"https://converse.nathcreqtives.com/1202/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723219661968.png",drm:true,source:"converge"},
            {name:"KIX",url:"https://converse.nathcreqtives.com/1263/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723129053549.png",drm:true,source:"converge"},
            {name:"ANC HD",url:"https://converse.nathcreqtives.com/1216/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723219396137.png",drm:true,source:"converge"},
            {name:"TAP SPORTS",url:"https://converse.nathcreqtives.com/1151/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723134161793.png",drm:true,source:"converge"},
            {name:"FASHION TV",url:"https://converse.nathcreqtives.com/1102/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723126284675.png",drm:true,source:"converge"},
            {name:"GNN tv44",url:"https://converse.nathcreqtives.com/1234/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1735903243498.png",drm:true,source:"converge"},
            {name:"TV5MONDE",url:"https://converse.nathcreqtives.com/1156/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723134373931.png",drm:true,source:"converge"},
            {name:"SOLAR SPORTS",url:"https://converse.nathcreqtives.com/1081/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723134030645.png",drm:true,source:"converge"},
            {name:"Heart Of Asia",url:"http://hls.nathcreqtives.com/playlist.m3u8?id=1",logo:"https://via.placeholder.com/150/333/fff?text=HOA",drm:false,source:"converge"},
            {name:"I Heart Movies",url:"http://hls.nathcreqtives.com/playlist.m3u8?id=2",logo:"https://via.placeholder.com/150/e74c3c/fff?text=IHM",drm:false,source:"converge"}
        ];

        let cignalChannels = [];
        let allChannels = [...convergeChannels];
        let currentChannel = 0;
        let shakaPlayer = null;
        let currentView = 'converge';
        let favorites = JSON.parse(localStorage.getItem('tv_fav') || '[]');
        let recent = JSON.parse(localStorage.getItem('tv_recent') || '[]');

        // Gumamit ng CORS proxy para siguradong ma-load ang M3U mo
        const CORS_PROXY = "https://api.allorigins.win/raw?url=";
        const CIGNAL_PLAYLIST = CORS_PROXY + encodeURIComponent("https://reiyhbit.github.io/iptv/playlist.m3u");

        async function loadCignal() {
            try {
                const res = await fetch(CIGNAL_PLAYLIST);
                const text = await res.text();
                const lines = text.split('\n');
                cignalChannels = [];
                let temp = {};
                for (let line of lines) {
                    line = line.trim();
                    if (line.startsWith('#EXTINF:')) {
                        const name = (line.match(/,(.+)$/) || [])[1]?.trim() || "Unknown";
                        const logo = (line.match(/tvg-logo="([^"]+)"/) || [])[1] || "https://via.placeholder.com/150/222/fff?text=CIGNAL";
                        const drm = line.includes('widevine');
                        temp = { name, logo, drm, source: "cignal" };
                    } else if (line.startsWith('http') && temp.name) {
                        temp.url = line;
                        cignalChannels.push(temp);
                        temp = {};
                    }
                }
                allChannels = [...convergeChannels, ...cignalChannels];
                renderChannels();
                console.log("Cignal loaded:", cignalChannels.length + " channels");
            } catch (e) {
                console.log("Cignal not loaded, using Converge only");
            }
        }

        async function init() {
            const video = document.getElementById('video');
            if (!shaka.Player.isBrowserSupported()) return alert("Chrome/Firefox lang po boss!");
            shakaPlayer = new shaka.Player(video);
            shakaPlayer.configure({ drm: { servers: { 'com.widevine.alpha': 'https://key.nathcreqtives.com/widevine/?deviceId=02:00:00:00:00:00' }}});
            await loadCignal();
            renderChannels();
            populateRecentlyWatched();
            playChannel(1);
        }

        async function playChannel(i) {
            const ch = allChannels[i];
            if (!ch) return;
            document.getElementById('ch-name').textContent = ch.source.toUpperCase() + " â€¢ " + ch.name;
            try {
                if (shakaPlayer && shakaPlayer.getAssetUri()) await shakaPlayer.unload();
                if (ch.drm) await shakaPlayer.load(ch.url);
                else { video.src = ch.url; video.play(); }
                currentChannel = i;
                addToRecent(i);
                renderChannels();
            } catch (e) { console.error(e); }
        }

        function nextChannel() { playChannel((currentChannel + 1) % allChannels.length); }
        function prevChannel() { playChannel((currentChannel - 1 + allChannels.length) % allChannels.length); }
        function reloadChannel() { playChannel(currentChannel); }
        function stopPlayback() { if(shakaPlayer) shakaPlayer.unload(); video.src = ''; }
        function toggleFullscreen() { document.fullscreenElement ? document.exitFullscreen() : document.getElementById('video-container').requestFullscreen(); }

        function toggleFav(i, e) { e.stopPropagation(); favorites.includes(i) ? favorites = favorites.filter(x=>x!==i) : favorites.push(i); localStorage.setItem('tv_fav', JSON.stringify(favorites)); renderChannels(); }
        function addToRecent(i) { recent = [i, ...recent.filter(x=>x!==i)].slice(0,10); localStorage.setItem('tv_recent', JSON.stringify(recent)); populateRecentlyWatched(); }

        function showView(v) {
            currentView = v;
            document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
            if(v==='favorites') document.querySelector('.tab.favorites').classList.add('active');
            else document.querySelectorAll('.tab')[v==='hls'?1 : v==='converge'?2 : 3].classList.add('active');
            renderChannels();
        }

        function renderChannels() {
            const grid = document.getElementById('channels-grid');
            grid.innerHTML = '';
            let list = currentView==='favorites' ? allChannels.filter((_,i)=>favorites.includes(i)) :
                       currentView==='converge' ? convergeChannels :
                       currentView==='cignal' ? cignalChannels :
                       currentView==='hls' ? allChannels.filter(c=>!c.drm) : allChannels;

            const term = document.getElementById('search').value.toLowerCase();
            list = list.filter(c=>c.name.toLowerCase().includes(term));

            list.forEach((ch,i) => {
                const idx = allChannels.indexOf(ch);
                const card = document.createElement('div');
                card.className = `channel-card ${idx===currentChannel?'playing':''}`;
                card.innerHTML = `
                    <img src="${ch.logo}" class="channel-logo" onerror="this.src='https://via.placeholder.com/150/222/fff?text=TV'">
                    <div class="channel-name">${ch.name}</div>
                    <div class="source-tag">${ch.source.toUpperCase()}</div>
                    <div class="fav-heart ${favorites.includes(idx)?'active':''}" onclick="toggleFav(${idx},event)"><i class="fas fa-heart"></i></div>
                `;
                card.onclick = () => playChannel(idx);
                grid.appendChild(card);
            });
        }

        function populateRecentlyWatched() {
            const list = document.getElementById('recent-list');
            list.innerHTML = '';
            recent.forEach(i => {
                const ch = allChannels[i]; if(!ch) return;
                const div = document.createElement('div'); div.className='recent-item';
                div.innerHTML = `<img src="${ch.logo}" class="recent-logo" onerror="this.src='https://via.placeholder.com/80/222/fff?text=TV'"><div class="recent-name">${ch.name}</div>`;
                div.onclick = () => playChannel(i);
                list.appendChild(div);
            });
        }

        setInterval(() => document.getElementById('clock').textContent = new Date().toLocaleTimeString('en-US',{hour12:false,hour:'2-digit',minute:'2-digit'}), 1000);
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
