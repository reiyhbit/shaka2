<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Player with Proxy</title>
    <style>
        /* Same styles as above */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #0a0a0a; color: white; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; padding: 20px; background: #111; border-radius: 10px; margin-bottom: 20px; }
        h1 { color: #00a8ff; margin-bottom: 10px; }
        .video-container { background: #111; border-radius: 10px; overflow: hidden; margin-bottom: 20px; }
        #videoPlayer { width: 100%; height: 500px; background: #000; }
        .channel-list { background: #111; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .channel-item { padding: 10px; margin: 5px 0; background: #222; border-radius: 5px; cursor: pointer; }
        .channel-item:hover { background: #333; }
        .channel-item.active { background: #00a8ff; color: white; }
        .controls { display: flex; gap: 10px; margin-top: 20px; }
        button { padding: 10px 20px; background: #00a8ff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0097e6; }
        .status { flex-grow: 1; padding: 10px; background: #222; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì∫ IPTV Player with Proxy</h1>
            <p>Using CORS proxy to avoid mixed content errors</p>
        </header>
        
        <div class="video-container">
            <video id="videoPlayer" controls crossorigin="anonymous">
                Your browser does not support DASH playback.
            </video>
        </div>
        
        <div class="channel-list">
            <h2>üì° Channels</h2>
            <div id="channelList"></div>
        </div>
        
        <div class="controls">
            <button onclick="playCurrent()">‚ñ∂ Play</button>
            <button onclick="pauseVideo()">‚è∏ Pause</button>
            <div class="status" id="status">Ready</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/dashjs/dist/dash.all.min.js"></script>
    <script>
        const channels = [
            {
                name: "Channel 1065",
                url: "http://136.158.97.2:6610/001/2/ch00000090990000001065/manifest.mpd?AuthInfo=v87HD9rEhwHiAdYyrP20TsXah2%2FZLFNNIdWrVrXDMAosKg8aLji3LHWqHUI%2FwQyJsyK4TH4mOENKJ45mwOyS0g%3D%3D&version=v1.0&BreakPoint=0&virtualDomain=001.live_hls.zte.com&programid=ch00000000000000001085&contentid=ch00000000000000001085&videoid=ch00000090990000001065&recommendtype=0&userid=1368249806492&boid=001&stbid=02%3A00%3A00%3A00%3A00%3A00&terminalflag=1&profilecode=&usersessionid=NJY3IWFAY6XXXX&NeedJITP=1&JITPMediaType=DASH&JITPDRMType=NO&IASHttpSessionId=RR20448820260101155236346387&ispcode=55",
                licenseKey: "https://ottmdrm.comclark.com/widevine/"
            },
            {
                name: "Channel 1075",
                url: "http://136.158.97.2:6610/001/2/ch00000090990000001075/manifest.mpd?AuthInfo=v87HD9rEhwHiAdYyrP20TsXah2%2FZLFNNIdWrVrXDMAqJxLC59eO5kyq497fsAC7QsyK4TH4mOENKJ45mwOyS0g%3D%3D&version=v1.0&BreakPoint=0&virtualDomain=001.live_hls.zte.com&programid=ch00000000000000001134&contentid=ch00000000000000001134&videoid=ch00000090990000001075&recommendtype=0&userid=1265632122474&boid=001&stbid=02%3A00%3A00%3A00%3A00%3A00&terminalflag=1&profilecode=&usersessionid=H3ED17F8SJXXXX&NeedJITP=1&JITPMediaType=DASH&JITPDRMType=NO&IASHttpSessionId=RR20447020260101155236141564&ispcode=55",
                licenseKey: "https://ottmdrm.comclark.com/widevine/"
            }
        ];

        const videoPlayer = document.getElementById('videoPlayer');
        const status = document.getElementById('status');
        let currentChannel = null;
        let player = null;

        // CORS Proxy function
        function getProxyUrl(url) {
            // Remove existing proxy if present
            url = url.replace(/^https?:\/\/corsproxy\.org\/?/, '');
            url = url.replace(/^https?:\/\/corsproxy\.io\/?/, '');
            
            // Encode the URL for proxy
            return `https://corsproxy.io/?${encodeURIComponent(url)}`;
        }

        // Initialize
        function init() {
            const channelList = document.getElementById('channelList');
            
            channels.forEach((channel, index) => {
                const div = document.createElement('div');
                div.className = 'channel-item';
                div.textContent = channel.name;
                div.onclick = () => loadChannel(index);
                channelList.appendChild(div);
            });

            // Initialize dash.js player
            player = dashjs.MediaPlayer().create();
            player.initialize(videoPlayer, null, true);
            
            // Try first channel
            if (channels.length > 0) {
                loadChannel(0);
            }
        }

        // Load channel
        function loadChannel(index) {
            currentChannel = index;
            const channel = channels[index];
            
            // Update UI
            document.querySelectorAll('.channel-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });
            
            status.textContent = `Loading ${channel.name}...`;
            
            // Use proxy URL
            const proxyUrl = getProxyUrl(channel.url);
            
            // Configure DRM
            const drmConfig = {
                drm: {
                    servers: {
                        "com.widevine.alpha": channel.licenseKey
                    }
                }
            };
            
            player.setProtectionData(drmConfig.drm);
            player.attachSource(proxyUrl);
            
            videoPlayer.play().then(() => {
                status.textContent = `Playing: ${channel.name}`;
            }).catch(err => {
                status.textContent = `Click play button to start ${channel.name}`;
            });
        }

        function playCurrent() {
            if (currentChannel !== null) {
                videoPlayer.play().then(() => {
                    status.textContent = `Playing: ${channels[currentChannel].name}`;
                });
            }
        }

        function pauseVideo() {
            videoPlayer.pause();
            status.textContent = 'Paused';
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
