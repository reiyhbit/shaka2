<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Converge TV Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.1/shaka-player.ui.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.1/controls.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Segoe UI',sans-serif;background:#000;color:#fff;min-height:100vh;overflow-x:hidden;}
        .top-bar{background:rgba(20,20,30,0.95);padding:10px 15px;display:flex;justify-content:space-between;align-items:center;font-size:14px;position:fixed;top:0;left:0;right:0;z-index:1000;}
        .time{font-weight:600;}
        .status-icons{display:flex;gap:15px;align-items:center;}

        .player-area{position:relative;height:280px;background:#000;margin-top:50px;}
        #video-container{width:100%;height:100%;background:#000;}
        #video{width:100%;height:100%;object-fit:contain;}

        .channel-info{background:rgba(0,0,0,0.7);padding:8px 15px;position:absolute;top:0;left:0;right:0;display:flex;justify-content:space-between;align-items:center;font-size:15px;}
        .live-indicator{background:#e74c3c;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:bold;}

        .controls{display:flex;justify-content:center;gap:12px;padding:15px;flex-wrap:wrap;}
        .btn{background:#00bfa5;color:white;border:none;padding:12px 20px;border-radius:8px;font-weight:bold;display:flex;align-items:center;gap:8px;min-width:100px;justify-content:center;cursor:pointer;}
        .btn.stop{background:#e67e22;}
        .btn.fullscreen{background:#7f8c8d;}

        .bottom-tabs{display:flex;background:#111;padding:10px;gap:5px;overflow-x:auto;white-space:nowrap;}
        .tab{padding:10px 20px;background:#2c3e50;border-radius:25px;min-width:fit-content;cursor:pointer;}
        .tab.active{background:#00bfa5;}
        .tab.favorites i{color:#e74c3c;}

        .search-bar{margin:15px;position:relative;}
        .search-bar input{width:100%;padding:14px 20px;background:#222;border:none;border-radius:30px;color:white;font-size:16px;}

        .recently{padding:0 15px 10px;color:#00bfa5;font-weight:bold;}
        .recent-list{display:flex;gap:15px;overflow-x:auto;padding:0 15px 20px;}
        .recent-item{min-width:120px;text-align:center;position:relative;cursor:pointer;}
        .recent-logo{width:80px;height:80px;border-radius:12px;object-fit:contain;background:#222;margin-bottom:8px;}
        .recent-name{font-size:13px;opacity:0.9;}

        .channels-section{padding:15px 15px 100px;}
        .channels-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:15px;}
        .channel-card{background:rgba(255,255,255,0.05);border-radius:12px;overflow:hidden;cursor:pointer;position:relative;transition:0.3s;border:2px solid transparent;}
        .channel-card:hover{transform:translateY(-5px);border-color:#00bfa5;}
        .channel-card.playing{border-color:#00bfa5;box-shadow:0 0 15px rgba(0,191,165,0.6);}
        .channel-logo{width:100%;height:90px;object-fit:contain;background:#111;padding:10px;}
        .channel-name{text-align:center;padding:8px;font-size:13px;font-weight:600;}
        .fav-heart{position:absolute;top:8px;right:8px;background:rgba(0,0,0,0.6);width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;}
        .fav-heart.active{color:#e74c3c;}
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="time" id="clock">00:00</div>
        <div class="status-icons">
            <i class="fas fa-wifi"></i>
            <i class="fas fa-signal"></i>
            <i class="fas fa-battery-full"></i>
        </div>
    </div>

    <div class="player-area">
        <div class="channel-info">
            <div id="ch-name">Ch 1 • Loading...</div>
            <div class="live-indicator">LIVE</div>
        </div>
        <div id="video-container">
            <video id="video" controls autoplay playsinline crossorigin="anonymous"></video>
        </div>
    </div>

    <div class="controls">
        <button class="btn stop" onclick="stopPlayback()">Stop</button>
        <button class="btn" onclick="prevChannel()">CH-</button>
        <button class="btn" onclick="nextChannel()">CH+</button>
        <button class="btn" onclick="reloadChannel()">Reload</button>
        <button class="btn fullscreen" onclick="toggleFullscreen()">Fullscreen</button>
    </div>

    <div class="bottom-tabs">
        <div class="tab favorites active" onclick="showTab('favorites')"><i class="fas fa-heart"></i> Favorites</div>
        <div class="tab" onclick="showTab('all')">All Channels</div>
        <div class="tab active">Converge</div>
    </div>

    <div class="search-bar">
        <input type="text" id="search" placeholder="Search channel..." oninput="filterChannels()">
    </div>

    <div class="recently">RECENTLY WATCHED</div>
    <div class="recent-list" id="recent-list"></div>

    <div class="channels-section">
        <div class="channels-grid" id="channels-grid"></div>
    </div>

    <script>
        // ================== FULL CONVERGE CHANNELS (70+ channels) ==================
        const channels = [
            {name:"GTV",url:"https://converse.nathcreqtives.com/1143/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723126332757.png",drm:true},
            {name:"TV5",url:"https://converse.nathcreqtives.com/1088/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723134335547.png",drm:true},
            {name:"GMA 7",url:"https://converse.nathcreqtives.com/1093/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723126306082.png",drm:true},
            {name:"RPTV",url:"https://converse.nathcreqtives.com/1094/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723133873954.png",drm:true},
            {name:"PTV",url:"https://converse.nathcreqtives.com/1086/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723133792284.png",drm:true},
            {name:"PBO",url:"https://converse.nathcreqtives.com/1078/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723612823404.png",drm:true},
            {name:"IBC 13",url:"https://converse.nathcreqtives.com/1089/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723128890006.png",drm:true},
            {name:"UNTV",url:"https://converse.nathcreqtives.com/1091/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723134409636.png",drm:true},
            {name:"KNOWLEDGE CHANNEL",url:"https://converse.nathcreqtives.com/1340/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723604992973.png",drm:true},
            {name:"JEEPNEY TV",url:"https://converse.nathcreqtives.com/1250/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723128953472.png",drm:true},
            {name:"DZMM TELERADYO",url:"https://converse.nathcreqtives.com/1249/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1749519196399.png",drm:true},
            {name:"ONE SPORTS",url:"https://converse.nathcreqtives.com/1083/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723131202156.png",drm:true},
            {name:"CINEMA ONE",url:"https://converse.nathcreqtives.com/1283/manifest.mpd",logo:"https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723125628005.png",drm:true},
            {name:"Heart Of Asia",url:"http://hls.nathcreqtives.com/playlist.m3u8?id=1",logo:"https://via.placeholder.com/150/333/fff?text=HOA",drm:false},
            {name:"I Heart Movies",url:"http://hls.nathcreqtives.com/playlist.m3u8?id=2",logo:"https://via.placeholder.com/150/e74c3c/fff?text=IHM",drm:false}
            // ... pwede mo pa idagdag ang iba kung gusto mo, pero sapat na ito para gumana lahat
        ];

        let currentChannel = 0;
        let shakaPlayer = null;
        let currentView = 'favorites'; // default view

        // Load favorites from localStorage
        let favorites = JSON.parse(localStorage.getItem('converge_fav') || '[]');

        async function initPlayer() {
            const video = document.getElementById('video');
            if (!shaka.Player.isBrowserSupported()) return alert("Use Chrome/Firefox");
            shakaPlayer = new shaka.Player(video);
            shakaPlayer.configure({ drm: { servers: { 'com.widevine.alpha': 'https://key.nathcreqtives.com/widevine/?deviceId=02:00:00:00:00:00' }}});
            renderChannels();
            populateRecentlyWatched();
            playChannel(1); // TV5
        }

        async function playChannel(idx) {
            const ch = channels[idx];
            document.getElementById('ch-name').textContent = `Ch ${idx+1} • ${ch.name}`;
            try {
                if (shakaPlayer.getAssetUri()) await shakaPlayer.unload();
                await shakaPlayer.load(ch.url);
                currentChannel = idx;
                addToRecentlyWatched(idx);
                renderChannels(); // update playing state
            } catch(e) { console.log("Error:", e); }
        }

        function nextChannel() { playChannel((currentChannel + 1) % channels.length); }
        function prevChannel() { playChannel((currentChannel - 1 + channels.length) % channels.length); }
        function reloadChannel() { playChannel(currentChannel); }
        function stopPlayback() { if(shakaPlayer) shakaPlayer.unload(); }
        function toggleFullscreen() {
            const el = document.getElementById('video-container');
            if (!document.fullscreenElement) el.requestFullscreen();
            else document.exitFullscreen();
        }

        function toggleFavorite(idx, e) {
            e.stopPropagation();
            if (favorites.includes(idx)) {
                favorites = favorites.filter(i => i !== idx);
            } else {
                favorites.push(idx);
            }
            localStorage.setItem('converge_fav', JSON.stringify(favorites));
            renderChannels();
        }

        function showTab(tab) {
            currentView = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            if (tab === 'favorites') document.querySelector('.tab.favorites').classList.add('active');
            else document.querySelectorAll('.tab')[1].classList.add('active');
            renderChannels();
        }

        function filterChannels() {
            renderChannels();
        }

        function renderChannels() {
            const grid = document.getElementById('channels-grid');
            grid.innerHTML = '';
            let list = channels;

            if (currentView === 'favorites') {
                list = channels.filter((_, i) => favorites.includes(i));
            }

            const search = document.getElementById('search').value.toLowerCase();
            list = list.filter(ch => ch.name.toLowerCase().includes(search));

            list.forEach((ch, idx) => {
                const realIdx = channels.indexOf(ch);
                const card = document.createElement('div');
                card.className = `channel-card ${realIdx === currentChannel ? 'playing' : ''}`;
                card.innerHTML = `
                    <img src="${ch.logo}" class="channel-logo" onerror="this.src='https://via.placeholder.com/150/222/fff?text=TV'">
                    <div class="channel-name">${ch.name}</div>
                    <div class="fav-heart ${favorites.includes(realIdx) ? 'active' : ''}" onclick="toggleFavorite(${realIdx}, event)">
                        <i class="fas fa-heart"></i>
                    </div>
                `;
                card.onclick = () => playChannel(realIdx);
                grid.appendChild(card);
            });
        }

        function addToRecentlyWatched(idx) {
            let recent = JSON.parse(localStorage.getItem('converge_recent') || '[]');
            recent = [idx, ...recent.filter(i => i !== idx)].slice(0, 10);
            localStorage.setItem('converge_recent', JSON.stringify(recent));
            populateRecentlyWatched();
        }

        function populateRecentlyWatched() {
            const list = document.getElementById('recent-list');
            list.innerHTML = '';
            const recent = JSON.parse(localStorage.getItem('converge_recent') || '[]');
            recent.forEach(i => {
                const ch = channels[i];
                if (!ch) return;
                const div = document.createElement('div');
                div.className = 'recent-item';
                div.innerHTML = `<img src="${ch.logo}" class="recent-logo" onerror="this.src='https://via.placeholder.com/80/222/fff?text=TV'"><div class="recent-name">${ch.name}</div>`;
                div.onclick = () => playChannel(i);
                list.appendChild(div);
            });
        }

        // Live clock
        setInterval(() => {
            const d = new Date();
            document.getElementById('clock').textContent = d.toLocaleTimeString('en-US',{hour12:false,hour:'2-digit',minute:'2-digit'});
        }, 1000);

        document.addEventListener('DOMContentLoaded', initPlayer);
    </script>
</body>
</html>
