<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PinoyFlix - Premium IPTV Player</title>
    <!-- Shaka Player CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.1/shaka-player.ui.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.1/controls.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .top-bar {
            background: rgba(20,20,30,0.95);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        .time { font-weight: 600; }
        .status-icons { display:flex; gap:15px; align-items:center; }
        
        /* Main Player Area */
        .player-area {
            position: relative;
            height: 280px;
            background: #000;
            margin-top: 50px;
        }
        #video-container {
            width: 100%;
            height: 100%;
            background: #000;
        }
        #video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* Channel Info Bar */
        .channel-info {
            background: rgba(0,0,0,0.7);
            padding: 8px 15px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
        }
        .live-indicator {
            background: #e74c3c;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
        }
        
        /* Control Buttons */
        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 15px;
            flex-wrap: wrap;
        }
        .btn {
            background: #00bfa5;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 100px;
            justify-content: center;
        }
        .btn.stop { background: #e67e22; }
        .btn.fullscreen { background: #7f8c8d; }
        
        /* Bottom Tabs */
        .bottom-tabs {
            display: flex;
            background: #111;
            padding: 10px;
            gap: 5px;
            overflow-x: auto;
            white-space: nowrap;
        }
        .tab {
            padding: 10px 20px;
            background: #2c3e50;
            border-radius: 25px;
            min-width: fit-content;
        }
        .tab.active {
            background: #00bfa5;
        }
        .tab.favorites { color: #e74c3c; }
        
        /* Search & Recently */
        .search-bar {
            margin: 15px;
            position: relative;
        }
        .search-bar input {
            width: 100%;
            padding: 14px 20px;
            background: #222;
            border: none;
            border-radius: 30px;
            color: white;
            font-size: 16px;
        }
        .hide-drm {
            margin: 0 15px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        
        /* Recently Watched */
        .recently {
            padding: 0 15px 20px;
            color: #00bfa5;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .recent-list {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 0 15px;
        }
        .recent-item {
            min-width: 120px;
            text-align: center;
        }
        .recent-logo {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: contain;
            background: #222;
            margin-bottom: 8px;
        }
        .recent-name {
            font-size: 13px;
            opacity: 0.9;
        }
        .favorite-heart {
            position: absolute;
            top: 5px;
            right: 5px;
            color: white;
            font-size: 20px;
        }
    </style>
</head>
<body>

    <!-- Top Status Bar -->
    <div class="top-bar">
        <div class="time">6:54</div>
        <div class="status-icons">
            <i class="fas fa-wifi"></i>
            <i class="fas fa-signal"></i>
            <i class="fas fa-battery-full"></i>
        </div>
    </div>

    <!-- Player -->
    <div class="player-area">
        <div class="channel-info">
            <div>Ch 3 • TV5</div>
            <div class="live-indicator">LIVE</div>
        </div>
        <div id="video-container">
            <video id="video" controls autoplay playsinline crossorigin="anonymous"></video>
        </div>
    </div>

    <!-- Controls -->
    <div class="controls">
        <button class="btn stop" onclick="stopPlayback()"><i class="fas fa-stop"></i> Stop</button>
        <button class="btn" onclick="prevChannel()"><i class="fas fa-chevron-left"></i> CH-</button>
        <button class="btn" onclick="nextChannel()"><i class="fas fa-chevron-right"></i> CH+</button>
        <button class="btn" onclick="reloadChannel()"><i class="fas fa-redo"></i> Reload</button>
        <button class="btn fullscreen" onclick="toggleFullscreen()"><i class="fas fa-expand"></i> Fullscreen</button>
    </div>

    <!-- Bottom Tabs -->
    <div class="bottom-tabs">
        <div class="tab favorites"><i class="fas fa-heart"></i> Favorites</div>
        <div class="tab">HLS</div>
        <div class="tab active">Converge</div>
        <div class="tab">Cignal</div>
    </div>

    <!-- Search -->
    <div class="search-bar">
        <input type="text" placeholder="Search channel...">
    </div>
    <div class="hide-drm">
        <input type="checkbox" id="hide-drm">
        <label for="hide-drm">Hide DRM channels</label>
    </div>

    <!-- Recently Watched -->
    <div class="recently">RECENTLY WATCHED</div>
    <div class="recent-list" id="recent-list">
        <!-- Will be filled by JS -->
    </div>

    <script>
        // Same channels data mo (hindi ko ginagalaw)
        const channels = [ /* ... lahat ng channels mo dito, parehas lang */ 
            { name: "GMA 7", url: "https://converse.nathcreqtives.com/1093/manifest.mpd", type: "dash", logo: "https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723126306082.png", category: "entertainment", drm: true, licenseKey: "https://key.nathcreqtives.com/widevine/?deviceId=02:00:00:00:00:00" },
            { name: "TV5", url: "https://converse.nathcreqtives.com/1088/manifest.mpd", type: "dash", logo: "https://ottepg8.comclark.com:8443/iptvepg/images/markurl/mark_1723134335547.png", category: "entertainment", drm: true, licenseKey: "https://key.nathcreqtives.com/widevine/?deviceId=02:00:00:00:00:00" },
            // ... iba pa
        ];

        let currentChannel = 0;
        let shakaPlayer = null;

        async function initShakaPlayer() {
            const video = document.getElementById('video');
            if (!shaka.Player.isBrowserSupported()) {
                alert("Browser not supported!");
                return;
            }
            shakaPlayer = new shaka.Player(video);
            shakaPlayer.configure({
                drm: { servers: { 'com.widevine.alpha': 'https://key.nathcreqtives.com/widevine/?deviceId=02:00:00:00:00:00' }}
            });
            playChannel(1); // TV5 para same sa picture
            populateRecentlyWatched();
        }

        async function playChannel(index) {
            if (!shakaPlayer) await initShakaPlayer();
            const ch = channels[index];
            document.querySelector('.channel-info div:first-child').textContent = `Ch ${index+1} • ${ch.name}`;
            try {
                await shakaPlayer.load(ch.url);
                currentChannel = index;
                addToRecentlyWatched(index);
            } catch(e) { console.error(e); }
        }

        function nextChannel() { playChannel((currentChannel + 1) % channels.length); }
        function prevChannel() { playChannel((currentChannel - 1 + channels.length) % channels.length); }
        function reloadChannel() { playChannel(currentChannel); }
        function stopPlayback() { if(shakaPlayer) shakaPlayer.unload(); }
        function toggleFullscreen() {
            const elem = document.getElementById('video-container');
            if (!document.fullscreenElement) elem.requestFullscreen();
            else document.exitFullscreen();
        }

        function addToRecentlyWatched(index) {
            let recent = JSON.parse(localStorage.getItem('recent') || '[]');
            recent = [index, ...recent.filter(i => i !== index)].slice(0, 8);
            localStorage.setItem('recent', JSON.stringify(recent));
            populateRecentlyWatched();
        }

        function populateRecentlyWatched() {
            const container = document.getElementById('recent-list');
            container.innerHTML = '';
            const recent = JSON.parse(localStorage.getItem('recent') || '[]');
            recent.forEach(idx => {
                const ch = channels[idx];
                if (!ch) return;
                const div = document.createElement('div');
                div.className = 'recent-item';
                div.innerHTML = `
                    <img src="${ch.logo}" class="recent-logo" onerror="this.src='https://via.placeholder.com/80/333/fff?text=TV'">
                    <div class="recent-name">${ch.name}</div>
                    <i class="fas fa-heart favorite-heart"></i>
                `;
                div.onclick = () => playChannel(idx);
                container.appendChild(div);
            });
        }

        document.addEventListener('DOMContentLoaded', initShakaPlayer);
    </script>
</body>
</html>
