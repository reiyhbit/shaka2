<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
   <title>My IPTV Player</title>
   <meta name="theme-color" content="#000000">
   <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
   <script src="https://unpkg.com/mux.js@5.10.0/dist/mux.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.16.9/dist/shaka-player.ui.min.js"></script>
   <link href="https://cdn.jsdelivr.net/npm/shaka-player@4.16.9/dist/controls.min.css" rel="stylesheet">
   <style>
     :root{--p:#2563eb;--ph:#1d4ed8;--bg:#0f0f0f;--c:#1a1a1a;--t:#fff;--ts:#a1a1aa;--b:#374151;}
     *{margin:0;padding:0;box-sizing:border-box;}
     body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--t);min-height:100vh;display:flex;flex-direction:column;}
     header{padding:1rem 2rem;background:var(--c);border-bottom:1px solid var(--b);text-align:center;font-size:1.5rem;font-weight:600;}
     main{flex:1;display:grid;grid-template-columns:1fr 350px;gap:1.5rem;padding:1.5rem;}
     @media(max-width:1024px){main{grid-template-columns:1fr;padding:1rem;}}
     #video-container{background:#000;position:relative;}
     video{width:100%;aspect-ratio:16/9;background:#000;}
     #channel-name{padding:1rem;background:var(--c);text-align:center;font-size:1.3rem;font-weight:600;border-top:1px solid var(--b);}
     .card{background:var(--c);border-radius:12px;padding:1.5rem;height:max-content;}
     select{width:100%;padding:1rem;background:#2d2d2d;border:1px solid var(--b);border-radius:8px;color:var(--t);font-size:1rem;}
     select:focus{border-color:var(--p);outline:none;}
     .toast{position:fixed;bottom:20px;right:20px;background:#10b981;color:#fff;padding:1rem 1.5rem;border-radius:8px;z-index:9999;opacity:0;transform:translateY(20px);transition:all .4s;}
     .toast.show{opacity:1;transform:translateY(0);}
     .toast.error{background:#ef4444;}
   </style>
</head>
<body>
  <header>My IPTV Player</header>
  <main>
    <div>
      <div id="video-container"><video id="video" autoplay playsinline></video></div>
      <div id="channel-name">Loading your channels...</div>
    </div>

    <div class="card">
      <select id="channelSelector"><option>Loading channels...</option></select>
    </div>
  </main>

  <div id="toast" class="toast"></div>

  <script>
    const video = document.getElementById('video');
    const videoContainer = document.getElementById('video-container');
    const channelName = document.getElementById('channel-name');
    const channelSelector = document.getElementById('channelSelector');
    const toast = document.getElementById('toast');
    let player, channels = [];

    // DIRECT LINK MO (walang upload, walang input)
    const MY_PLAYLIST = "https://reiyhbit.github.io/iptv/playlist112525.m3u";
    const PROXY = "https://api.allorigins.win/raw?url=";

    function show(msg, error = false, time = 3000) {
      toast.textContent = msg;
      toast.className = "toast" + (error ? " error" : "") + " show";
      setTimeout(() => toast.classList.remove("show"), time);
    }

    async function loadPlaylist() {
      try {
        show("Loading your playlist...");
        const res = await fetch(PROXY + encodeURIComponent(MY_PLAYLIST));
        const text = await res.text();
        channels = parseM3U(text);
        populateChannels();
        show(`Loaded ${channels.length} channels! Playing first one...`);
        channelSelector.selectedIndex = 1;
        playChannel(0);
      } catch(e) {
        show("Failed to load playlist", true, 8000);
        console.error(e);
      }
    }

    function parseM3U(data) {
      const lines = data.split("\n");
      const list = [];
      let ch = {};
      for (const line of lines) {
        const l = line.trim();
        if (l.startsWith("#EXTINF:")) {
          ch.name = l.split(",").pop().trim();
        } else if (l && !l.startsWith("#")) {
          ch.url = l;
          list.push({...ch});
          ch = {};
        }
      }
      return list;
    }

    function populateChannels() {
      channelSelector.innerHTML = '<option value="">Select Channel</option>';
      channels.forEach((c,i respecting)=> {
        const opt = new Option(c.name, i);
        channelSelector.add(opt);
      });
    }

    function playChannel(index) {
      const ch = channels[index];
      if (!ch) return;
      channelName.textContent = "Loading: " + ch.name;
      manifestUri = ch.url;
      player.load(manifestUri).then(()=>{
        channelName.textContent = ch.name;
      }).catch(()=>{
        channelName.textContent = "Failed: " + ch.name;
      });
    }

    channelSelector.onchange = () => {
      const i = channelSelector.value;
      if (i !== "") playChannel(parseInt(i));
    };

    // Init Shaka Player
    shaka.polyfill.installAll();
    player = new shaka.Player(video);
    new shaka.ui.Overlay(player, videoContainer, video);

    // Start everything
    loadPlaylist();
  </script>
</body>
</html>
